<script>
  function showLocation() {
    const output = document.getElementById("location");

    if (!navigator.geolocation) {
      output.textContent = "Геолокация не поддерживается браузером.";
      return;
    }

    navigator.geolocation.getCurrentPosition(async position => {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;

      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json&addressdetails=1`, {
          headers: {
            'User-Agent': 'YourAppName/1.0 (your@email.com)'
          }
        });
        const data = await response.json();

        const address = data.address;

        const house = address.house_number || "";
        const road = address.road || address.pedestrian || address.footway || "";
        const city = address.city || address.town || address.village || "";
        const state = address.state || "";
        const country = address.country || "";

        let fullAddress = "";
        if (road) fullAddress += road;
        if (house) fullAddress += `, ${house}`;
        if (city) fullAddress += `, ${city}`;
        if (state) fullAddress += `, ${state}`;
        if (country) fullAddress += `, ${country}`;

        output.textContent = fullAddress || "Адрес не найден.";
      } catch (err) {
        output.textContent = "Не удалось получить адрес.";
      }
    }, (error) => {
      switch(error.code) {
        case error.PERMISSION_DENIED:
          output.textContent = "Доступ к геопозиции запрещён.";
          break;
        case error.POSITION_UNAVAILABLE:
          output.textContent = "Информация о местоположении недоступна.";
          break;
        case error.TIMEOUT:
          output.textContent = "Время ожидания геопозиции истекло.";
          break;
        default:
          output.textContent = "Неизвестная ошибка геопозиции.";
      }
    });
  }

  showLocation();
</script>
